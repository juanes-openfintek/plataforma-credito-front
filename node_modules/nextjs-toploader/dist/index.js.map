{"version":3,"sources":["../src/index.tsx"],"sourcesContent":["// deno-ts-ignore-file\n// deno-lint-ignore-file\n/* eslint-disable no-var */\n/* eslint-disable max-len */\n/* eslint-disable prefer-const */\n/* eslint-disable quotes */\n\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport * as NProgress from 'nprogress';\n// @deno-types =\"npm:preact@10.19.6\"\n\n// @deno-types =\"npm:nprogress@0.2.2\"\n\n// @deno-types =\"npm:@types/react@18.2.66\"\n\nexport type NextTopLoaderProps = {\n  /**\n   * Color for the TopLoader.\n   * @default \"#29d\"\n   */\n  color?: string;\n  /**\n   * The initial position for the TopLoader in percentage, 0.08 is 8%.\n   * @default 0.08\n   */\n  initialPosition?: number;\n  /**\n   * The increament delay speed in milliseconds.\n   * @default 200\n   */\n  crawlSpeed?: number;\n  /**\n   * The height for the TopLoader in pixels (px).\n   * @default 3\n   */\n  height?: number;\n  /**\n   * Auto increamenting behaviour for the TopLoader.\n   * @default true\n   */\n  crawl?: boolean;\n  /**\n   * To show spinner or not.\n   * @default true\n   */\n  showSpinner?: boolean;\n  /**\n   * Animation settings using easing (a CSS easing string).\n   * @default \"ease\"\n   */\n  easing?: string;\n  /**\n   * Animation speed in ms for the TopLoader.\n   * @default 200\n   */\n  speed?: number;\n  /**\n   * Defines a shadow for the TopLoader.\n   * @default \"0 0 10px ${color},0 0 5px ${color}\"\n   *\n   * @ you can disable it by setting it to `false`\n   */\n  shadow?: string | false;\n  /**\n   * Defines a template for the TopLoader.\n   * @default \"<div class=\"bar\" role=\"bar\"><div class=\"peg\"></div></div>\n   * <div class=\"spinner\" role=\"spinner\"><div class=\"spinner-icon\"></div></div>\"\n   */\n  template?: string;\n  /**\n   * Defines zIndex for the TopLoader.\n   * @default 1600\n   *\n   */\n  zIndex?: number;\n  /**\n   * To show the TopLoader at bottom.\n   * @default false\n   *\n   */\n  showAtBottom?: boolean;\n};\n\n/**\n *\n * NextTopLoader\n *\n */\nconst NextTopLoader = ({\n  color: propColor,\n  height: propHeight,\n  showSpinner,\n  crawl,\n  crawlSpeed,\n  initialPosition,\n  easing,\n  speed,\n  shadow,\n  template,\n  zIndex = 1600,\n  showAtBottom = false,\n}: NextTopLoaderProps): JSX.Element => {\n  const defaultColor = '#29d';\n  const defaultHeight = 3;\n\n  const color = propColor ?? defaultColor;\n  const height = propHeight ?? defaultHeight;\n\n  // Any falsy (except undefined) will disable the shadow\n  const boxShadow =\n    !shadow && shadow !== undefined\n      ? ''\n      : shadow\n      ? `box-shadow:${shadow}`\n      : `box-shadow:0 0 10px ${color},0 0 5px ${color}`;\n\n  // Check if to show at bottom\n  const positionStyle = showAtBottom ? 'bottom: 0;' : 'top: 0;';\n  const spinnerPositionStyle = showAtBottom ? 'bottom: 15px;' : 'top: 15px;';\n\n  /**\n   * CSS Styles for the NextTopLoader\n   */\n  const styles = (\n    <style>\n      {`#nprogress{pointer-events:none}#nprogress .bar{background:${color};position:fixed;z-index:${zIndex};${positionStyle}left:0;width:100%;height:${height}px}#nprogress .peg{display:block;position:absolute;right:0;width:100px;height:100%;${boxShadow};opacity:1;-webkit-transform:rotate(3deg) translate(0px,-4px);-ms-transform:rotate(3deg) translate(0px,-4px);transform:rotate(3deg) translate(0px,-4px)}#nprogress .spinner{display:block;position:fixed;z-index:${zIndex};${spinnerPositionStyle}right:15px}#nprogress .spinner-icon{width:18px;height:18px;box-sizing:border-box;border:2px solid transparent;border-top-color:${color};border-left-color:${color};border-radius:50%;-webkit-animation:nprogress-spinner 400ms linear infinite;animation:nprogress-spinner 400ms linear infinite}.nprogress-custom-parent{overflow:hidden;position:relative}.nprogress-custom-parent #nprogress .bar,.nprogress-custom-parent #nprogress .spinner{position:absolute}@-webkit-keyframes nprogress-spinner{0%{-webkit-transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg)}}@keyframes nprogress-spinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}`}\n    </style>\n  );\n\n  /**\n   * Convert the url to Absolute URL based on the current window location.\n   * @param url {string}\n   * @returns {string}\n   */\n  const toAbsoluteURL = (url: string): string => {\n    return new URL(url, window.location.href).href;\n  };\n\n  /**\n   * Check if it is hash anchor or same page anchor\n   * @param currentUrl {string} Current Url Location\n   * @param newUrl {string} New Url detected with each anchor\n   * @returns {boolean}\n   */\n  const isHashAnchor = (currentUrl: string, newUrl: string): boolean => {\n    const current = new URL(toAbsoluteURL(currentUrl));\n    const next = new URL(toAbsoluteURL(newUrl));\n    return current.href.split('#')[0] === next.href.split('#')[0];\n  };\n\n  /**\n   * Check if it is Same Host name\n   * @param currentUrl {string} Current Url Location\n   * @param newUrl {string} New Url detected with each anchor\n   * @returns {boolean}\n   */\n  const isSameHostName = (currentUrl: string, newUrl: string): boolean => {\n    const current = new URL(toAbsoluteURL(currentUrl));\n    const next = new URL(toAbsoluteURL(newUrl));\n    return current.hostname.replace(/^www\\./, '') === next.hostname.replace(/^www\\./, '');\n  };\n\n  React.useEffect((): ReturnType<React.EffectCallback> => {\n    NProgress.configure({\n      showSpinner: showSpinner ?? true,\n      trickle: crawl ?? true,\n      trickleSpeed: crawlSpeed ?? 200,\n      minimum: initialPosition ?? 0.08,\n      easing: easing ?? 'ease',\n      speed: speed ?? 200,\n      template:\n        template ??\n        '<div class=\"bar\" role=\"bar\"><div class=\"peg\"></div></div><div class=\"spinner\" role=\"spinner\"><div class=\"spinner-icon\"></div></div>',\n    });\n\n    /**\n     * Check if the Current Url is same as New Url\n     * @param currentUrl {string}\n     * @param newUrl {string}\n     * @returns {boolean}\n     */\n    function isAnchorOfCurrentUrl(currentUrl: string, newUrl: string): boolean {\n      const currentUrlObj = new URL(currentUrl);\n      const newUrlObj = new URL(newUrl);\n      // Compare hostname, pathname, and search parameters\n      if (\n        currentUrlObj.hostname === newUrlObj.hostname &&\n        currentUrlObj.pathname === newUrlObj.pathname &&\n        currentUrlObj.search === newUrlObj.search\n      ) {\n        // Check if the new URL is just an anchor of the current URL page\n        const currentHash = currentUrlObj.hash;\n        const newHash = newUrlObj.hash;\n        return (\n          currentHash !== newHash && currentUrlObj.href.replace(currentHash, '') === newUrlObj.href.replace(newHash, '')\n        );\n      }\n      return false;\n    }\n\n    // deno-lint-ignore no-var\n    var nProgressClass: NodeListOf<HTMLHtmlElement> = document.querySelectorAll('html');\n\n    const removeNProgressClass = (): void =>\n      nProgressClass.forEach((el: Element) => el.classList.remove('nprogress-busy'));\n\n    /**\n     * Find the closest anchor to trigger\n     * @param element {HTMLElement | null}\n     * @returns element {Element}\n     */\n    function findClosestAnchor(element: HTMLElement | null): HTMLAnchorElement | null {\n      while (element && element.tagName.toLowerCase() !== 'a') {\n        element = element.parentElement;\n      }\n      return element as HTMLAnchorElement;\n    }\n\n    /**\n     *\n     * @param event {MouseEvent}\n     * @returns {void}\n     */\n    function handleClick(event: MouseEvent): void {\n      try {\n        const target = event.target as HTMLElement;\n        const anchor = findClosestAnchor(target);\n        const newUrl = anchor?.href;\n        if (newUrl) {\n          const currentUrl = window.location.href;\n          // const newUrl = (anchor as HTMLAnchorElement).href;\n          const isExternalLink = (anchor as HTMLAnchorElement).target === '_blank';\n\n          // Check for Special Schemes\n          const isSpecialScheme = ['tel:', 'mailto:', 'sms:', 'blob:', 'download:'].some((scheme) =>\n            newUrl.startsWith(scheme)\n          );\n\n          const isAnchor: boolean = isAnchorOfCurrentUrl(currentUrl, newUrl);\n          const notSameHost = !isSameHostName(window.location.href, anchor.href);\n          if (notSameHost) {\n            return;\n          }\n          if (\n            newUrl === currentUrl ||\n            isAnchor ||\n            isExternalLink ||\n            isSpecialScheme ||\n            event.ctrlKey ||\n            event.metaKey ||\n            event.shiftKey ||\n            event.altKey ||\n            isHashAnchor(window.location.href, anchor.href) ||\n            !toAbsoluteURL(anchor.href).startsWith('http')\n          ) {\n            NProgress.start();\n            NProgress.done();\n            removeNProgressClass();\n          } else {\n            NProgress.start();\n          }\n        }\n      } catch (err) {\n        // Log the error in development only!\n        // console.log('NextTopLoader error: ', err);\n        NProgress.start();\n        NProgress.done();\n      }\n    }\n\n    /**\n     * Complete TopLoader Progress\n     * @param {History}\n     * @returns {void}\n     */\n    ((history: History): void => {\n      const pushState = history.pushState;\n      history.pushState = (...args) => {\n        NProgress.done();\n        removeNProgressClass();\n        return pushState.apply(history, args);\n      };\n    })((window as Window).history);\n\n    function handlePageHide(): void {\n      NProgress.done();\n      removeNProgressClass();\n    }\n\n    /**\n     * Handle Browser Back and Forth Navigation\n     * @returns {void}\n     */\n    function handleBackAndForth(): void {\n      NProgress.done();\n    }\n\n    // Add the global click event listener\n    window.addEventListener('popstate', handleBackAndForth);\n    document.addEventListener('click', handleClick);\n    window.addEventListener('pagehide', handlePageHide);\n\n    // Clean up the global click event listener when the component is unmounted\n    return (): void => {\n      document.removeEventListener('click', handleClick);\n      window.removeEventListener('pagehide', handlePageHide);\n      window.removeEventListener('popstate', handleBackAndForth);\n    };\n  }, []);\n\n  return styles;\n};\nexport default NextTopLoader;\n\nNextTopLoader.propTypes = {\n  color: PropTypes.string,\n  height: PropTypes.number,\n  showSpinner: PropTypes.bool,\n  crawl: PropTypes.bool,\n  crawlSpeed: PropTypes.number,\n  initialPosition: PropTypes.number,\n  easing: PropTypes.string,\n  speed: PropTypes.number,\n  template: PropTypes.string,\n  shadow: PropTypes.oneOfType([PropTypes.string, PropTypes.bool]),\n  zIndex: PropTypes.number,\n  showAtBottom: PropTypes.bool,\n};\n"],"mappings":"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","names":["src_exports","__export","src_default","__toCommonJS","PropTypes","React","NProgress","NextTopLoader","__name","propColor","propHeight","showSpinner","crawl","crawlSpeed","initialPosition","easing","speed","shadow","template","zIndex","showAtBottom","defaultColor","color","height","boxShadow","styles","toAbsoluteURL","url","isHashAnchor","currentUrl","newUrl","current","next","isSameHostName","isAnchorOfCurrentUrl","currentUrlObj","newUrlObj","currentHash","newHash","nProgressClass","removeNProgressClass","el","findClosestAnchor","element","handleClick","event","target","anchor","isExternalLink","isSpecialScheme","scheme","isAnchor","err","history","pushState","args","handlePageHide","handleBackAndForth","src_default"]}